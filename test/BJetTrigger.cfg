process test = {
 
    # input file
    source = PoolSource {
        untracked vstring fileNames = {'/store/unmerged/RelVal/2006/8/13/RelVal090BJets50-120/GEN-SIM-DIGI-RECO/0005/2E94F02F-102B-DB11-9E3E-0002B3D8E8FF.root  '}
        untracked int32 maxEvents = 10
    }

    # Message Logger
//    include "FWCore/MessageLogger/data/MessageLogger.cfi"
//    replace MessageLogger.cout.threshold = "DEBUG"
// debug printout
        service = MessageLogger {
          untracked vstring destinations = {"cout"}
          untracked PSet cout = { untracked string threshold = "DEBUG" }
          untracked vstring debugModules = {"hltL25b"}
        }

    #
    # General event reconstruction
    #

    # Jet reconstruction already done in input dataset.
#    include "RecoJets/JetProducers/data/CaloJetMcone5.cfi"

#   Offline primary vertices.
#    include "MagneticField/Engine/data/volumeBasedMagneticField.cfi"
#    include "RecoVertex/PrimaryVertexProducer/data/OfflinePrimaryVerticesFromCTFTracks.cff"

#   Pixel primary vertices and tracks.
   include "TrackingTools/TransientTrack/data/TransientTrackBuilder.cfi" 
   include "RecoPixelVertexing/PixelTrackFitting/data/PixelTracks.cff"
   include "RecoPixelVertexing/PixelVertexFinding/data/PixelVertexes.cff"  
#

   #
    # Additional event reconstruction needed for L2.5 b HLT.
    #

    module associatorL25 = JetTracksAssociator {
      string tracks = "pixelTracks"
      string jets   = "midPointCone5CaloJets"
      double coneSize = 0.5
    }

    module trackCountingL25 = TrackCounting {
      string jetTracks = "associatorL25"
      string primaryVertex = "pixelVertices"        
      string outputInstanceName = "TrackCounting"


      PSet AlgorithmPSet =  { 
         int32  NthTrack = 2
         int32  ImpactParamterType = 1 
         int32  MinimumNumberOfPixelHits = 2
         int32  MinimumNumberOfHits = 2
         double MaximumTransverseImpactParameter = 0.2
         double MinimumTransverseMomentum = 1.0
         double MaximumDecayLength = 5.0
         double MaximumChiSquared = 5.0
         double MaximumLongitudinalImpactParameter = 170.0
      }
    }

    #
    # Additional event reconstruction needed for L3 b HLT.
    #

    module associatorL3 = JetTracksAssociator {
      string tracks = "ctfWithMaterialTracks"
      string jets   = "midPointCone5CaloJets"
      double coneSize = 0.5
    }

    module trackCountingL3 = TrackCounting {
      string jetTracks = "associatorL3"
      string primaryVertex = "offlinePrimaryVerticesFromCTFTracks"        
      string outputInstanceName = "TrackCounting"

      PSet AlgorithmPSet =  { 
         int32  NthTrack = 2
         int32  ImpactParamterType = 1 
         int32  MinimumNumberOfPixelHits = 2
         int32  MinimumNumberOfHits = 8
         double MaximumTransverseImpactParameter = 0.2
         double MinimumTransverseMomentum = 1.0
         double MaximumDecayLength = 5.0
         double MaximumChiSquared = 5.0
         double MaximumLongitudinalImpactParameter = 170.0
      }
    }

    #
    # Trigger modules
    #

    module hltL25b = HLTJetTag {
      InputTag JetTag   = trackCountingL25:TrackCounting
      double   MinTag   = 2.0
      double   MaxTag   = 99999.
      int32    MinN     = 1
    }

//    module hltL3b = HLTJetTag {
//      InputTag JetTag   = trackCountingL3:TrackCounting
//      double   MinTag   = 2.0
//      double   MaxTag   = 99999.
//      int32    MinN     = 1
//    }

    # Event reconstruction needed for trigger.

    sequence recon = {pixelTracks, pixelVertices, 
                      associatorL25, 
                      trackCountingL25}

#    sequence recon = {offlinePrimaryVerticesFromCTFTracks, 
#                      associatorL3, 
#                      trackCountingL3}

    # Trigger path
    path p1 = {recon, hltL25b}
#    path p1 = {recon, hltL3b}

    # Write events passing trigger

    module out = PoolOutputModule {
      untracked string fileName = 'file:HLToutput.root'
      untracked PSet SelectEvents = {
        vstring SelectEvents = { "p1" }
      }
    }

    endpath outpath = { out }
}
